# YS Framework 差距分析与改进报告

基于对当前项目的深度分析，本报告详细列出了 YS Framework 作为通用开发框架的现状、差距及改进建议。

## 1. 核心架构设计补充 (Core Architecture)

**现状评估**: 采用 TurboRepo 管理 Monorepo，实现了 `apps` (业务) 与 `packages` (通用能力) 的物理分离，分层清晰。

| 维度 | 现状 | 差距/缺口 | 建议方案 | 优先级 |
| :--- | :--- | :--- | :--- | :--- |
| **分层架构** | 前后端分离，后端有 Controller/Service/Repo (Drizzle) 分层。 | **领域层薄弱**: 业务逻辑主要集中在 Service，缺乏明确的领域模型(Domain)层，复杂业务下易导致 Service 膨胀。 | 引入 DDD (领域驱动设计) 轻量级实践，在 `lib` 中定义更纯粹的 Domain Entity 和 Value Object。 | 中 |
| **模块解耦** | 使用 NestJS Module 机制。 | **模块间通信强耦合**: 模块间多为直接 Service 注入调用，缺乏事件驱动的解耦机制。 | 引入 **Event Bus (事件总线)** 模块，支持同步(In-Memory)和异步(Redis/MQ)事件分发，降低模块间耦合。 | 高 |
| **扩展机制** | 依赖 NestJS 动态模块。 | **缺乏插件协议**: 没有定义标准的“插件(Plugin)”接口，无法在不修改核心代码的情况下挂载新功能。 | 设计 `PluginLoader` 和 `PluginInterface`，支持生命周期钩子 (onLoad, onUnload)，允许插件注入路由、菜单和中间件。 | 高 |

## 2. 基础功能模块缺口 (Basic Modules)

**现状评估**: 认证(Auth)、存储(Storage)、数据库(DB)、缓存(Cache) 等核心设施已非常完善。

| 模块类别 | 缺失/待增强组件 | 场景描述 | 改进建议 | 优先级 |
| :--- | :--- | :--- | :--- | :--- |
| **消息通知** | **多渠道通知中心** | 当前仅有 Mail 模块。缺乏 SMS (短信)、Push (推送)、In-App (站内信) 的统一抽象。 | 构建 `NotificationModule`，抽象 Channel 适配器模式，支持多种发送渠道的统一调度和模板管理。 | 高 |
| **支付计费** | **支付网关 & 订阅** | SaaS/AI 产品必备的支付能力缺失。 | 集成 Stripe/LemonSqueezy 或支付宝/微信支付 SDK，实现基础的“订阅(Subscription)”和“充值(Credits)”模型。 | 中 |
| **实时通信** | **WebSocket 网关** | 当前 Nginx 支持 Upgrade，但后端缺 Socket.io/WS 模块，无法支持实时协作/即时消息。 | 引入 NestJS Gateway 模块，实现房间管理、消息广播和在线状态维护。 | 中 |
| **系统管理** | **配置中心/字典管理** | 依赖 `.env` 和代码常量，缺乏运行时动态配置能力。 | 开发“系统配置表”及管理 API，支持动态开关功能特性（Feature Flags）和管理数据字典。 | 低 |

## 3. 开发者体验优化 (DX)

**现状评估**: 基础 Lint/Test 工具链完备，Docker 环境友好。

| 维度 | 现状 | 差距/缺口 | 建议方案 | 优先级 |
| :--- | :--- | :--- | :--- | :--- |
| **CLI 工具** | 仅依赖 `package.json` 脚本。 | **无脚手架**: 创建新模块/页面需手动复制粘贴，易出错且风格不统一。 | 开发 `ys-cli` (基于 Commander/Inquirer)，提供 `ys g module [name]`、`ys g resource` 等命令，自动生成标准代码结构。 | 高 |
| **文档中心** | 仅有 Swagger 和 README。 | **缺乏开发指南**: 缺少架构理念、目录规范、最佳实践等文档站。 | 搭建基于 VitePress 或 Docusaurus 的文档站点，包含“快速开始”、“架构概览”和“API 参考”。 | 中 |
| **调试诊断** | Pino 日志。 | **缺乏链路追踪**: 在微服务/分布式场景下难以排查跨服务调用问题。 | 引入 **OpenTelemetry** SDK，集成 Jaeger 或 Zipkin，实现全链路请求追踪。 | 低 |
| **错误处理** | 有全局异常过滤器。 | **错误码规范**: 缺乏统一的业务错误码定义和前端适配。 | 建立统一的 `AppError` 类和错误码字典 (Error Code Registry)，前端通过拦截器统一处理错误提示。 | 中 |

## 4. 生态系统建设 (Ecosystem)

**现状评估**: 作为一个框架，目前更像是一个私有项目模板。

| 维度 | 建议措施 | 目标 |
| :--- | :--- | :--- |
| **插件市场** | 暂缓建设，但需预留接口。 | 允许第三方开发者开发如“飞书集成”、“微信登录”等插件。 |
| **贡献机制** | 添加 `CONTRIBUTING.md`。 | 明确分支管理、Commit 规范 (Conventional Commits) 和 PR 流程。 |
| **周边工具** | VS Code 插件。 | 提供 Snippets 代码片段和配置文件的智能提示。 |

## 5. 性能与安全 (Performance & Security)

**现状评估**: 基础安全（验证码、限流、加密）做得很好。

| 维度 | 缺失点 | 建议方案 |
| :--- | :--- | :--- |
| **可观测性** | **监控大盘缺失** | 集成 Prometheus + Grafana，提供默认的系统监控仪表盘（CPU、内存、QPS、错误率）。 |
| **安全审计** | **操作审计日志** | 缺乏对敏感操作（删除数据、修改配置）的记录。实现 `AuditLog` 装饰器，自动记录操作人、IP、旧值/新值。 |
| **性能优化** | **API 响应缓存** | 对于读多写少的接口（如配置、字典），引入 Redis 缓存层的自动注解支持 (`@Cacheable`)。 |

## 6. 总结与行动路线图

**第一阶段（固本强基）**:
1.  **CLI 工具**: 开发脚手架，统一代码生成标准。
2.  **事件总线**: 实现模块解耦。
3.  **通知中心**: 扩展除邮件外的通知能力。

**第二阶段（功能补全）**:
1.  **WebSocket**: 支持实时能力。
2.  **支付模块**: 打通商业化闭环。
3.  **文档站**: 建立完整的开发者文档。

**第三阶段（生态扩展）**:
1.  **插件系统**: 开放扩展能力。
2.  **可观测性**: 完善监控体系。
